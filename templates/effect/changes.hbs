<section class="tab changes{{#if tab.active}} active{{/if}}" data-group="{{tab.group}}" data-tab="{{tab.id}}" data-part="changes">
    <header>
        <div class="key">{{localize "EFFECT.ChangeKey"}}</div>
        <div class="mode">{{localize "EFFECT.ChangeMode"}}</div>
        <div class="value">{{localize "EFFECT.ChangeValue"}}</div>
        <div class="priority">{{localize "EFFECT.ChangePriority"}}</div>
        <div class="controls"><a data-action="addChange"><i class="fa-regular fa-square-plus"></i></a></div>
    </header>
    <ol class="scrollable" data-changes>
        {{#each source.changes as |change i|}}
        <li data-index="{{i}}">
            <div class="key">
                <select name="changes.{{i}}.key" class="select-keyname">
                    <option value></option>
                    <optgroup label={{localize "SW25.Effect.Battle"}}>
                    {{selectOptions ../effectOptions.battle selected=change.key localize=true}}
                    </optgroup>
                    <optgroup label={{localize "SW25.Effect.Check"}}>
                    {{selectOptions ../effectOptions.check selected=change.key localize=true}}
                    </optgroup>
                    <optgroup label={{localize "SW25.Effect.Parameter"}}>
                    {{selectOptions ../effectOptions.parameter selected=change.key localize=true}}
                    </optgroup>
                    <optgroup label={{localize "SW25.Effect.MagicPower"}}>
                    {{selectOptions ../effectOptions.magicpower selected=change.key localize=true}}
                    </optgroup>
                    <optgroup label={{localize "SW25.Effect.MagicCKRoll"}}>
                    {{selectOptions ../effectOptions.magicckroll selected=change.key localize=true}}
                    </optgroup>
                    <optgroup label={{localize "SW25.Effect.MagicPWRoll"}}>
                    {{selectOptions ../effectOptions.magicpwroll selected=change.key localize=true}}
                    </optgroup>
                    <optgroup label={{localize "SW25.Effect.MPSave"}}>
                    {{selectOptions ../effectOptions.mpsave selected=change.key localize=true}}
                    </optgroup>
                    <optgroup label={{localize "SW25.Features"}}>
                    {{selectOptions ../effectOptions.feature selected=change.key localize=true}}
                    </optgroup>
                    <optgroup label={{localize "SW25.Effect.Powertable"}}>
                    {{selectOptions ../effectOptions.powertable selected=change.key localize=true}}
                    </optgroup>

                    <optgroup label={{localize "SW25.Effect.ClassPdamage"}}>
                    {{selectOptions ../effectOptions.classPdamage selected=change.key localize=true}}
                    </optgroup>
                    <optgroup label={{localize "SW25.Effect.ClassPdecay"}}>
                    {{selectOptions ../effectOptions.classPdecay selected=change.key localize=true}}
                    </optgroup>
                    <optgroup label={{localize "SW25.Effect.ElementPdamage"}}>
                    {{selectOptions ../effectOptions.elementPdamage selected=change.key localize=true}}
                    </optgroup>
                    <optgroup label={{localize "SW25.Effect.ElementPdecay"}}>
                    {{selectOptions ../effectOptions.elementPdecay selected=change.key localize=true}}
                    </optgroup>
                    <optgroup label={{localize "SW25.Effect.ClassMdamage"}}>
                    {{selectOptions ../effectOptions.classMdamage selected=change.key localize=true}}
                    </optgroup>
                    <optgroup label={{localize "SW25.Effect.ClassMdecay"}}>
                    {{selectOptions ../effectOptions.classMdecay selected=change.key localize=true}}
                    </optgroup>
                    <optgroup label={{localize "SW25.Effect.ElementMdamage"}}>
                    {{selectOptions ../effectOptions.elementMdamage selected=change.key localize=true}}
                    </optgroup>
                    <optgroup label={{localize "SW25.Effect.ElementMdecay"}}>
                    {{selectOptions ../effectOptions.elementMdecay selected=change.key localize=true}}
                    </optgroup>
                    <option value="checkinput" {{#if (eq this.keyClassification "checkinput")}}selected{{/if}}>{{localize "SW25.Effect.ChecknameInput"}}</option>
                    <option value="input" {{#if (eq this.keyClassification "input")}}selected{{/if}}>{{localize "SW25.Effect.DirectInput"}}</option>
                </select>
                {{#if (eq this.keyClassification "checkinput")}}
                    <input style="max-width: calc(60% - 7px);" type="text" class="dynamic-input" name="changes.{{i}}.key" value="{{change.checkname}}"/>
                {{/if}}
                {{#if (eq this.keyClassification "input")}}
                    <input style="max-width: calc(60% - 7px);" type="text" class="dynamic-input" name="changes.{{i}}.key" value="{{change.key}}"/>
                {{/if}}
            </div>
{{log this}}
        {{#with ../fields.changes.element.fields as |changeFields|}}
            <div class="mode">
                {{formInput changeFields.mode name=(concat "changes." i ".mode") value=change.mode choices=@root.modes}}
            </div>
            <div class="value">
                {{formInput changeFields.value name=(concat "changes." i ".value") value=change.value}}
            </div>
            <div class="priority">
                {{formInput changeFields.priority name=(concat "changes." i ".priority") value=change.priority
                    placeholder=(lookup ../../priorities change.mode)}}
            </div>
            <div class="controls"><a data-action="deleteChange"><i class="fa-solid fa-trash"></i></a></div>
        </li>
        {{/with}}
        {{/each}}
    </ol>
</section>
